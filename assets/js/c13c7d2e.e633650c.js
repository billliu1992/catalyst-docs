"use strict";(self.webpackChunkcodebase_doctor_docs=self.webpackChunkcodebase_doctor_docs||[]).push([[21],{9878:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});var a=n(5893),o=n(1151);const r={sidebar_position:6},s="Other Node.JS Server Framework",i={id:"install/other-node",title:"Other Node.JS Server Framework",description:"Before you manually instrument, please check if we provide a package for your choice of HTTP server! If we don't provide a package, we'd",source:"@site/docs/install/other-node.md",sourceDirName:"install",slug:"/install/other-node",permalink:"/docs/install/other-node",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"Other Web Frameworks",permalink:"/docs/install/other-web"},next:{title:"Guides",permalink:"/docs/category/guides"}},d={},l=[{value:"Add the dependency",id:"add-the-dependency",level:2},{value:"Initialize the library",id:"initialize-the-library",level:2},{value:"Instrumenting",id:"instrumenting",level:2},{value:"Creating a Context",id:"creating-a-context",level:3},{value:"Recording an HTTP Request",id:"recording-an-http-request",level:3},{value:"Propagate Session Info",id:"propagate-session-info",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h1,{id:"other-nodejs-server-framework",children:"Other Node.JS Server Framework"}),"\n",(0,a.jsx)(t.admonition,{type:"note",children:(0,a.jsxs)(t.p,{children:["Before you manually instrument, please check if we provide a package for your choice of HTTP server! If we don't provide a package, we'd\nstill like to work with you. Please reach out either ",(0,a.jsx)(t.a,{href:"mailto:bill@privium.xyz",children:"through e-mail"})," or ",(0,a.jsx)(t.a,{href:"https://discord.gg/YQZy4SXzmX",children:"via Discord"}),"."]})}),"\n",(0,a.jsxs)(t.p,{children:["For a working example, please checkout our ",(0,a.jsx)(t.a,{href:"https://github.com/catalyst-monitor/catalyst-examples",children:"examples repo"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"add-the-dependency",children:"Add the dependency"}),"\n",(0,a.jsx)(t.p,{children:"To get started, add the core Javascript library to your Node.js application:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",metastring:'title="Terminal"',children:"npm install @catalyst-monitor/core\n\n# Alternatively, if you use Yarn:\nyarn add @catalyst-monitor/core\n"})}),"\n",(0,a.jsx)(t.h2,{id:"initialize-the-library",children:"Initialize the library"}),"\n",(0,a.jsx)(t.p,{children:"Initialize the library as early as possible:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="index.ts"',children:"import { installNodeBase } from '@catalyst-monitor/core/node'\n\nconst sdf = installNodeBase({\n  privateKey: '<YOUR PRIVATEY KEY HERE>', // The private key from the \"Settings\" page in the Catalyst dashboard.\n  systemName: 'catalyst-js-express-example',  // The name given to this service. All endpoints will be grouped by this name.\n  version: '<YOUR VERSION CODE HERE>', // Any to differentiate different deploys, e.g. Git commit SHA\n})\n"})}),"\n",(0,a.jsx)(t.h2,{id:"instrumenting",children:"Instrumenting"}),"\n",(0,a.jsx)(t.p,{children:"Being able to breakdown your errors and logs by HTTP request can greatly speed up your triage and debugging processes."}),"\n",(0,a.jsxs)(t.p,{children:["An example of the Express instrumentation code can be found ",(0,a.jsx)(t.a,{href:"https://github.com/catalyst-monitor/catalyst-js/blob/main/packages/express/src/index.ts",children:"here"}),"."]}),"\n",(0,a.jsx)(t.h3,{id:"creating-a-context",children:"Creating a Context"}),"\n",(0,a.jsxs)(t.p,{children:["In order for Catalyst to associate logs and errors to the individual request, you'll need to create a context. You can do so by calling ",(0,a.jsx)(t.code,{children:"getCatalystWeb().recordPageView(...)"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:"import {\n  createCatalystContext,\n  ServerRequestContext,\n  SESSION_ID_HEADER,\n  PAGE_VIEW_ID_HEADER,\n  PARENT_FETCH_ID_HEADER,\n} from '@catalyst-monitor/core/node'\n\nconst context: ServerRequestContext = {\n    fetchId: crypto.randomUUID(),\n    sessionId: 'SESSION_ID_HERE', // Value of header from SESSION_ID_HEADER\n    pageViewId: 'PAGE_VIEW_ID', // Value of header from PAGE_VIEW_ID_HEADER\n    parentFetchId: 'PARENT_FETCH_ID', // Value of header from PARENT_FETCH_ID_HEADER\n}\n\ncreateCatalystContext(context, () => {\n    // Your endpoint code here.\n})\n"})}),"\n",(0,a.jsx)(t.p,{children:"Afterwards, you can obtain and pass this context object when calling Catalyst:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:"import { getCatalystNode, getCatalystContext } from '@catalyst-monitor/core/node'\n\nconst context = getCatalystContext()\nif (context != null) {\n    getCatalystNode().recordLog('error', e, {}, context)\n}\n"})}),"\n",(0,a.jsx)(t.h3,{id:"recording-an-http-request",children:"Recording an HTTP Request"}),"\n",(0,a.jsxs)(t.p,{children:["To record an HTTP request, simply take the context you've created, and pass it into ",(0,a.jsx)(t.code,{children:"recordFetch"}),"."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",children:"import { getCatalystNode, getCatalystContext } from '@catalyst-monitor/core/node'\n\nconst context = getCatalystContext()\n\nif (context != null) {\n    getCatalystNode().recordFetch(\n         // The HTTP method, e.g. get, post, put\n        'get',\n\n        // The path pattern, unreplaced.\n        '/widgets/:widgetId',\n\n        // The path parameter values.\n        { widgetId: 'a' },\n\n        // The HTTP status code, as a number.\n        200,\n\n        {\n            seconds: 5, // Number of seconds this request took.\n            nanos: 0, // Number of nanoseconds after the second.\n        },\n        context)\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Catalyst is not opinionated on the format of the path pattern. For best results, always pass in the path pattern and param separately. This will give you an aggregate view of logs and errors per path pattern, while still letting you drill down on individual visits."}),"\n",(0,a.jsx)(t.h2,{id:"propagate-session-info",children:"Propagate Session Info"}),"\n",(0,a.jsxs)(t.p,{children:["Replace ",(0,a.jsx)(t.code,{children:"fetch(...)"})," calls to servers with Catalyst installed with the provided ",(0,a.jsx)(t.code,{children:"catalystNodeFetch"}),". This will ensure session info is correctly propagated."]}),"\n",(0,a.jsxs)(t.p,{children:["Note that ",(0,a.jsx)(t.code,{children:"catalystNodeFetch"})," has the same interface as ",(0,a.jsx)(t.code,{children:"fetch"}),", so you can simply drop the new function in."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-ts",metastring:'title="api.ts"',children:"import { catalystNodeFetch as cFetch } from '@catalyst-monitor/core/node'\n\nawait cFetch(\"/api/widget/123\", {\n  method: method,\n})\n"})})]})}function h(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>s});var a=n(7294);const o={},r=a.createContext(o);function s(e){const t=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),a.createElement(r.Provider,{value:t},e.children)}}}]);